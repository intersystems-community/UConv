<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Routine name="impexp" type="MAC" languagemode="0"><![CDATA[
#include Globs
#include %occStatus
Start
	w #
	  WRITE $TEXT(TextLabel+1),!
	  WRITE $TEXT(TextLabel+2),!
	  WRITE $TEXT(TextLabel+3),!
	  w $TEXT(TextLabel+4),! 
	  w $TEXT(TextLabel+5),! 
	  w $TEXT(TextLabel+6),! 
	do {w $TEXT(TextLabel+7) r job,! }
	while ((job'="1")&&(job'="2")&&(job'="3")&&(job'="q"))
	if (job="2") { GOTO Import }
	elseif (job="1") { GOTO Export }
	elseif (job="3") {GOTO FromFile}
	else {w "bye!"}
	Quit
	
Import
	w "Import section:"
	w !, "Type in filename or type nothing to create socket server: "
	r filename
	if (filename="q") GOTO Start
	d ^importGlobal(filename)
	Quit
	
Export
	w "Export section:"
	set GlobList=""
				do
				{
WriteSect
				r !,"Write name of global: ", glob
				if (glob="q") GOTO Start
				set GlobList = ##class(Globals.Utils).NameSpaceGlobalList("DEV",glob,0)
				w !, "You have chosen ",$listlength(GlobList), " globals",!
				} while('$listlength(GlobList))
				r !,"Write filename or IP(port 7001): ", link
				if (link="q") GOTO WriteSect
				

	set SockFlag=0			
  	SET file = ##class(%Stream.FileCharacter).%New()
  	set file.Filename=link
  	if ('(file.IsNull())) { d file.MoveToEnd() }
  	SET blocksWritten = 0, buffer=""
  	set file.RemoveOnClose=0
  	set sock=##class(%IO.Socket).%New(), sock.TranslationTable="UTF8"
  	do sock.Open(link,"7031",1,.sc)
  	if ($$$ISOK(sc)) { set file=sock, SockFlag=1 }
  
  
				set ptr=0
				while ($LISTNEXT(GlobList,ptr,val)) {
					do ^exportGlobal("^"_val,file,SockFlag,.buffer)
					}
					do Final^exportGlobal("^"_val,.file,SockFlag,.buffer)
				
	Quit
	
FromFile
	w #, "Settings from file:"
	w !, "Type in filename, where the settings are stored: "
	r filename
	set filet = ##class(%Stream.FileCharacter).%New()
	set filet.Filename=filename
	while('filet.AtEnd)
	{
		set str = filet.ReadLine()
		if ($e(str,1,2)="im") {
			d ^importGlobal($e(str,8,*))
			w !,"Global ", $e(str,8,*), " imported",!
			} 
		else {
			d ^exportGlobal($e(str,8,$f(str,",")-2),$e(str,$f(str,","),*))
			w !,"Global ", $e(str,8,$f(str,",")-2), " exported",!
			}
	}
	Quit
	
TextLabel /*****************************
Welcome to the Export/Import master
It helps to transfer globals between 8bit- && 16bit- versions of Cache
Choose what you want to do?
1) Export Section
2) Import Section
3) Choose file with settings
Your action:
*****************************/ 
quit
]]></Routine>
</Export>
